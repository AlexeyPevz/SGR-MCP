# ⚠️ ВАЖНО: Требование Structured Output для MCP-SGR

## TL;DR

**MCP-SGR требует моделей с поддержкой Structured Output для эффективной работы.**

Модели без этой поддержки показывают снижение качества в 4-5 раз.

## Результаты тестирования

### ✅ Модели С поддержкой Structured Output
| Модель | Средний Score | Надежность |
|--------|---------------|------------|
| Claude 3.5 (все версии) | 0.95 | Отличная |
| GPT-4/GPT-4o | 0.95 | Отличная |
| Gemini Pro/Flash | 0.90 | Хорошая |

### ❌ Модели БЕЗ поддержки Structured Output
| Модель | Средний Score | Проблемы |
|--------|---------------|----------|
| Llama 3.1 | 0.20 | Неструктурированный вывод |
| Mixtral | 0.15 | Игнорирует схемы |
| Qwen (старые версии) | 0.10 | Непредсказуемый формат |

## Почему это критично

1. **SGR полагается на структурированные схемы** - без гарантии формата вывода невозможно надежно парсить reasoning
2. **Каскадные ошибки** - ошибка парсинга на первом шаге ломает весь pipeline
3. **Потеря информации** - без структуры теряются важные части reasoning

## Рекомендации

### Для production использования

**ИСПОЛЬЗУЙТЕ ТОЛЬКО:**
- OpenAI GPT-4o, GPT-4o-mini (с осторожностью - иногда отклоняет схемы)
- Anthropic Claude 3.5 Haiku/Sonnet
- Google Gemini Pro 1.5, Flash 1.5

**НЕ ИСПОЛЬЗУЙТЕ:**
- Open source модели без structured output
- Старые версии коммерческих моделей
- Модели через прокси без поддержки response_format

### Проверка поддержки

```python
# Быстрый тест поддержки structured output
response = await llm_client.generate(
    prompt="Test",
    response_format={
        "type": "json_schema",
        "json_schema": {
            "name": "test",
            "schema": {"type": "object", "properties": {"test": {"type": "string"}}}
        }
    }
)
# Если ошибка 400 - модель не поддерживает
```

## Альтернативы (НЕ рекомендуется)

Если вынуждены использовать модель без structured output:
1. Используйте только режим "baseline" без SGR
2. Добавьте extensive retry логику
3. Упростите схемы до минимума
4. Ожидайте снижение качества на 70-80%

## Заключение

**Structured Output - это не опция, а требование для MCP-SGR.** 

Выбор модели без этой поддержки делает использование SGR бессмысленным.