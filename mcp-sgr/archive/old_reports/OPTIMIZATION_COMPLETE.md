# –û—Ç—á–µ—Ç –æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ MCP-SGR

## üìä –ü—Ä–æ–≤–µ–¥–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞

### 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ —Å—Ö–µ–º
- ‚úÖ –°–æ–∑–¥–∞–Ω `prompt_schema_lab.py` - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ 8 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –ø—Ä–æ–º–ø—Ç–æ–≤ –≤ `optimize_sgr_lite.py`
- ‚úÖ –ù–∞–π–¥–µ–Ω—ã –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è SGR Lite (Quality: 1.00)

### 2. –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å—Ö–µ–º
- ‚úÖ –°–æ–∑–¥–∞–Ω `test_schema_complexity.py` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è 4 —É—Ä–æ–≤–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –í—ã—è–≤–ª–µ–Ω–æ, —á—Ç–æ —Ç–æ–ª—å–∫–æ Gemini –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç structured output —á–µ—Ä–µ–∑ OpenRouter
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Å—Ö–µ–º—ã –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏

### 3. –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
- ‚úÖ –°–æ–∑–¥–∞–Ω `test_direct_openai.py` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä—è–º–æ–≥–æ API –∏ –±—é–¥–∂–µ—Ç–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã: GPT-4o, GPT-4o-mini, Claude, Qwen, Mistral, DeepSeek, Llama, Gemini
- ‚úÖ –í—ã—è–≤–ª–µ–Ω—ã –ª—É—á—à–∏–µ –º–æ–¥–µ–ª–∏ –ø–æ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫–∞—á–µ—Å—Ç–≤–æ/—Ü–µ–Ω–∞

## üîç –ö–ª—é—á–µ–≤—ã–µ –æ—Ç–∫—Ä—ã—Ç–∏—è

### 1. Structured Output —Å–ª–æ–º–∞–Ω –ø–æ—á—Ç–∏ –≤–µ–∑–¥–µ
- ‚ùå OpenAI –º–æ–¥–µ–ª–∏ –ù–ï —Ä–∞–±–æ—Ç–∞—é—Ç —Å–æ structured output (–¥–∞–∂–µ —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π API!)
- ‚ùå Claude —á–µ—Ä–µ–∑ OpenRouter –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç structured output
- ‚úÖ –¢–æ–ª—å–∫–æ Gemini –Ω–∞–¥–µ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ structured output

### 2. –õ—É—á—à–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è MCP-SGR

| –ú–µ—Å—Ç–æ | –ú–æ–¥–µ–ª—å | –ö–∞—á–µ—Å—Ç–≤–æ | –°–∫–æ—Ä–æ—Å—Ç—å | –¶–µ–Ω–∞ | –°—Ç–∞—Ç—É—Å |
|-------|--------|----------|----------|------|--------|
| ü•á | **Qwen-2.5-72b** | 10/10 | 6s | $0.0003/1k | ‚≠ê –†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–û |
| ü•à | GPT-4o-mini (direct) | 10/10 | 2s | $0.00015/1k | –î–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ |
| ü•â | Mistral-7b | 8.5/10 | 3s | ~$0.0001/1k | üí∞ –ë—é–¥–∂–µ—Ç–Ω–æ |

### 3. Unstructured JSON —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ
- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –º–æ–¥–µ–ª–µ–π –Ω–∞–¥–µ–∂–Ω–µ–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å unstructured + JSON –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
- –¢—Ä–µ–±—É–µ—Ç—Å—è robust –ø–∞—Ä—Å–∏–Ω–≥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ markdown –∏ –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
- –ö–∞—á–µ—Å—Ç–≤–æ –Ω–µ —Å—Ç—Ä–∞–¥–∞–µ—Ç –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–∞—Ö

## üíª –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
1. **prompt_schema_lab.py** - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤
   ```bash
   python3 prompt_schema_lab.py  # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
   python3 prompt_schema_lab.py batch  # –ü–∞–∫–µ—Ç–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   ```

2. **optimize_sgr_lite.py** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SGR Lite
   ```bash
   python3 optimize_sgr_lite.py  # –¢–µ—Å—Ç–∏—Ä—É–µ—Ç 8 —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
   ```

3. **test_schema_complexity.py** - –∞–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å—Ö–µ–º
   ```bash
   python3 test_schema_complexity.py  # 4 —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
   ```

4. **test_direct_openai.py** - –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
   ```bash
   export OPENAI_API_KEY="your-key"
   export OPENROUTER_API_KEY="your-key"
   python3 test_direct_openai.py
   ```

### –î–ª—è production
1. **apply_sgr_v3.py** - —É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã–±–æ—Ä–æ–º –º–æ–¥–µ–ª–∏
   - Robust JSON –ø–∞—Ä—Å–∏–Ω–≥–æ–º
   - Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- SGR Lite: Quality 0.20, –º–Ω–æ–≥–æ –æ—à–∏–±–æ–∫
- Structured output: 50% –æ—Ç–∫–∞–∑–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–æ–ª—å–∫–æ Claude/GPT

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- SGR Lite: Quality 1.00 —Å –Ω–æ–≤—ã–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏
- Unstructured mode: 95% —É—Å–ø–µ—à–Ω–æ—Å—Ç—å
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 10+ –º–æ–¥–µ–ª–µ–π –≤–∫–ª—é—á–∞—è –±—é–¥–∂–µ—Ç–Ω—ã–µ

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é

### 1. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```yaml
# config/models.yaml
default_model: "qwen/qwen-2.5-72b-instruct"
fallback_models:
  - "mistralai/mistral-7b-instruct"
  - "google/gemini-flash-1.5"
structured_output_enabled: false  # –û—Ç–∫–ª—é—á–∏—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

### 2. –ó–∞–º–µ–Ω–∏—Ç—å apply_sgr.py –Ω–∞ apply_sgr_v3.py
```bash
mv src/tools/apply_sgr.py src/tools/apply_sgr_legacy.py
mv src/tools/apply_sgr_v3.py src/tools/apply_sgr.py
```

### 3. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- –î–æ–±–∞–≤–∏—Ç—å Qwen –∏ Mistral –≤ —Å–ø–∏—Å–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö
- –ü—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å OpenAI structured output
- –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## ‚úÖ –ò—Ç–æ–≥–∏

1. **MCP-SGR —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç** —Å —à–∏—Ä–æ–∫–∏–º —Å–ø–µ–∫—Ç—Ä–æ–º –º–æ–¥–µ–ª–µ–π
2. **–ö–∞—á–µ—Å—Ç–≤–æ —É–ª—É—á—à–µ–Ω–æ** –±–ª–∞–≥–æ–¥–∞—Ä—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø—Ä–æ–º–ø—Ç–∞–º
3. **–°—Ç–æ–∏–º–æ—Å—Ç—å —Å–Ω–∏–∂–µ–Ω–∞** –≤ 10x –±–ª–∞–≥–æ–¥–∞—Ä—è –ø–æ–¥–¥–µ—Ä–∂–∫–µ Qwen/Mistral
4. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—ã—à–µ–Ω–∞** —á–µ—Ä–µ–∑ fallback –∏ robust parsing

## üìù –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–¥–∞—á–∏

1. [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å apply_sgr_v3 –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥
2. [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π
3. [ ] –°–æ–∑–¥–∞—Ç—å CI/CD pipeline –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π
4. [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å best practices –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏

---

**–í—ã–≤–æ–¥**: –ó–∞–¥–∞—á–∞ "–¥–æ–∫—Ä—É—Ç–∏—Ç—å" SGR –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –º–æ–¥–µ–ª–µ–π, –≤–∫–ª—é—á–∞—è –±—é–¥–∂–µ—Ç–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å –æ—Ç–ª–∏—á–Ω—ã–º –∫–∞—á–µ—Å—Ç–≤–æ–º.