# –§–∏–Ω–∞–ª—å–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ SGR: –ò—Ç–æ–≥–∏ –≤—Å–µ—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤

## üîç –ß—Ç–æ –º—ã —É–∑–Ω–∞–ª–∏

–ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è –ø–æ–¥—Ö–æ–¥–∞ Abdullin –∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Ç–µ—Å—Ç–æ–≤, –∫–∞—Ä—Ç–∏–Ω–∞ –ø—Ä–æ—è—Å–Ω—è–µ—Ç—Å—è:

### 1. –î–≤–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞ –∫ SGR

#### –ù–∞—à –¥–≤—É—Ö—Ñ–∞–∑–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
- **–§–∞–∑–∞ 1**: –ê–Ω–∞–ª–∏–∑ —Å JSON —Å—Ö–µ–º–æ–π
- **–§–∞–∑–∞ 2**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞
- **–ü—Ä–æ–±–ª–µ–º—ã**: –î–≤–æ–π–Ω—ã–µ API –≤—ã–∑–æ–≤—ã, —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤ 3-7 —Ä–∞–∑

#### –ü–æ–¥—Ö–æ–¥ Abdullin (–æ–¥–Ω–æ—Ñ–∞–∑–Ω—ã–π):
- **–û–¥–Ω–∞ —Ñ–∞–∑–∞**: –ü—Ä—è–º–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
- **–°—Ö–µ–º–∞ –∫–∞–∫ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ**: JSON —Å—Ö–µ–º–∞ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å reasoning
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: –û–¥–∏–Ω API –≤—ã–∑–æ–≤, —Ñ–æ—Ä—Å–∏—Ä—É–µ—Ç –ø–æ–ª–Ω–æ—Ç—É –æ—Ç–≤–µ—Ç–∞

### 2. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥—Ö–æ–¥–∞ Abdullin

```
Mistral-7B:    -100% (–ø–æ–ª–Ω—ã–π –ø—Ä–æ–≤–∞–ª —Å JSON)
Qwen-2.5-72B:  +25.6% (–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ!)
Gemini-Flash:  -45.1% (–ø—Ä–æ–±–ª–µ–º—ã —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º)
```

### 3. –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

1. **–ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ –∏–¥–µ–µ SGR, –∞ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**
   - –î–≤—É—Ö—Ñ–∞–∑–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Å–ª–∏—à–∫–æ–º –¥–æ—Ä–æ–≥–æ–π
   - –û–¥–Ω–æ—Ñ–∞–∑–Ω—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö –º–æ–¥–µ–ª–µ–π

2. **–ú–æ–¥–µ–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã**
   - –ú–∞–ª–µ–Ω—å–∫–∏–µ –º–æ–¥–µ–ª–∏ (7B) –Ω–µ —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
   - –ë–æ–ª—å—à–∏–µ –º–æ–¥–µ–ª–∏ (70B+) –æ—Ç–ª–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ö–µ–º—ã

3. **SGR –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á**
   - –ö–æ–¥-—Ä–µ–≤—å—é: +8-10% —É–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞
   - –°–∏—Å—Ç–µ–º–Ω—ã–π –¥–∏–∑–∞–π–Ω: +43% –¥–ª—è Qwen-2.5-72B
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ SGR

```python
# ‚ùå –ü–õ–û–•–û: –î–≤—É—Ö—Ñ–∞–∑–Ω—ã–π SGR (–Ω–∞—à –∏–∑–Ω–∞—á–∞–ª—å–Ω—ã–π)
def apply_sgr_two_phase(task):
    # –§–∞–∑–∞ 1: –ê–Ω–∞–ª–∏–∑
    analysis = call_llm(task, analysis_schema)  # $$$
    # –§–∞–∑–∞ 2: –°–∏–Ω—Ç–µ–∑
    response = call_llm(analysis, task)        # $$$
    return response  # –î–æ—Ä–æ–≥–æ –∏ –º–µ–¥–ª–µ–Ω–Ω–æ

# ‚úÖ –•–û–†–û–®–û: –û–¥–Ω–æ—Ñ–∞–∑–Ω—ã–π SGR (Abdullin)
def apply_sgr_single_phase(task):
    schema = create_reasoning_schema(task)
    response = call_llm(task, schema)  # $
    return response  # –î–µ—à–µ–≤–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ
```

### 2. –í—ã–±–∏—Ä–∞–π—Ç–µ –º–æ–¥–µ–ª–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞

```python
MODELS_FOR_SGR = {
    "excellent": "qwen/qwen-2.5-72b-instruct",     # +25% —Å SGR
    "avoid": "mistralai/mistral-7b-instruct",      # -100% —Å SGR
    "unstable": "google/gemini-flash-1.5"          # –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º
}
```

### 3. –î–∏–∑–∞–π–Ω —Å—Ö–µ–º –¥–ª—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è reasoning

```json
{
  "reasoning_trace": {
    "problem_understanding": "–ß—Ç–æ –Ω—É–∂–Ω–æ —Ä–µ—à–∏—Ç—å?",
    "key_considerations": ["–§–∞–∫—Ç–æ—Ä 1", "–§–∞–∫—Ç–æ—Ä 2"],
    "step_by_step_analysis": [
      {"step": 1, "action": "...", "reasoning": "..."}
    ],
    "solution": "–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ",
    "validation": "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—à–µ–Ω–∏—è"
  }
}
```

### 4. –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SGR

**‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SGR –¥–ª—è:**
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ (–∫–æ–¥-—Ä–µ–≤—å—é, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è)
- –ò–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- –ó–∞–¥–∞—á —Ç—Ä–µ–±—É—é—â–∏—Ö —è–≤–Ω–æ–≥–æ reasoning trail
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –º–∞—à–∏–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ SGR –¥–ª—è:**
- –ü—Ä–æ—Å—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç –∑–∞–¥–∞—á
- –¢–≤–æ—Ä—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á (–Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞)
- –ú–∞–ª–µ–Ω—å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π (<70B –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
- –ö–æ–≥–¥–∞ –±—é–¥–∂–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω

## üìä –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä

```python
# –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è SGR
async def apply_sgr_optimized(
    task: str,
    task_type: str = "analysis"
) -> Dict[str, Any]:
    
    # 1. –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏
    model = "qwen/qwen-2.5-72b-instruct"  # –õ—É—á—à–∞—è –¥–ª—è SGR
    
    # 2. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ø–æ–¥ –∑–∞–¥–∞—á—É
    if task_type == "code_review":
        schema = {
            "issues": [...],
            "recommendations": [...],
            "severity_assessment": ...
        }
    elif task_type == "system_design":
        schema = {
            "requirements_analysis": ...,
            "solution_components": ...,
            "tradeoffs": ...
        }
    
    # 3. –û–¥–Ω–æ—Ñ–∞–∑–Ω—ã–π –≤—ã–∑–æ–≤
    response = await call_llm_with_schema(
        model=model,
        task=task,
        schema=schema,
        temperature=0.1  # –ù–∏–∑–∫–∞—è –¥–ª—è consistency
    )
    
    return response
```

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π –≤–µ—Ä–¥–∏–∫—Ç

**SGR –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω, –Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–Ω–æ—Ñ–∞–∑–Ω—ã–π –ø–æ–¥—Ö–æ–¥** (–∫–∞–∫ —É Abdullin)
2. **–¢–æ–ª—å–∫–æ —Å –±–æ–ª—å—à–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏** (70B+)
3. **–î–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á** (–∞–Ω–∞–ª–∏–∑, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
4. **–° —Ö–æ—Ä–æ—à–æ –ø—Ä–æ–¥—É–º–∞–Ω–Ω—ã–º–∏ —Å—Ö–µ–º–∞–º–∏**

**–î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∑–∞–¥–∞—á –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ —Ö–æ—Ä–æ—à–µ–π –º–æ–¥–µ–ª–∏:**
- Qwen-2.5-72B –¥–∞—ë—Ç –æ—Ç–ª–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–∑ SGR
- –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–æ–º–ø—Ç—ã —á–∞—Å—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ —Å–ª–æ–∂–Ω—ã—Ö —Å—Ö–µ–º
- –§–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –≤—ã–±–æ—Ä–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏

---

*–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏ –∏ –º–æ–¥–µ–ª—è–º–∏. SGR ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∞ –Ω–µ –ø–∞–Ω–∞—Ü–µ—è.*