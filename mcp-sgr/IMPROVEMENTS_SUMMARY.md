# –ò—Ç–æ–≥–∏ —É–ª—É—á—à–µ–Ω–∏–π MCP-SGR

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. ‚úÖ –ß–µ—Ç–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

**–§–∞–π–ª**: `STRUCTURED_OUTPUT_REQUIREMENT.md`

- –Ø—Å–Ω–æ —É–∫–∞–∑–∞–Ω–æ, —á—Ç–æ **structured output –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã SGR
- –ü—Ä–∏–≤–µ–¥–µ–Ω —Å–ø–∏—Å–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –º–æ–¥–µ–ª–µ–π
- –ü–æ–∫–∞–∑–∞–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã: –º–æ–¥–µ–ª–∏ –±–µ–∑ structured output –¥–∞—é—Ç –∫–∞—á–µ—Å—Ç–≤–æ –≤ 4-5 —Ä–∞–∑ —Ö—É–∂–µ

### 2. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è apply_sgr

**–§–∞–π–ª**: `src/tools/apply_sgr_v2.py`

–ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ structured output** —É –º–æ–¥–µ–ª–∏
- **–£–ø—Ä–æ—â–µ–Ω–∏–µ —Å—Ö–µ–º** –¥–ª—è –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö –º–æ–¥–µ–ª–µ–π
- **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** —Å fallback –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã** - —É–±—Ä–∞–ª–∏ –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å
- **–õ—É—á—à–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–æ–≤** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ JSON –∏–∑ –ª—é–±–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞

### 3. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ —Ä–æ—É—Ç–∏–Ω–≥–∞

**–§–∞–π–ª**: `config/router_policy_v2.yaml`

- –ú–æ–¥–µ–ª–∏ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –ø–æ–¥–¥–µ—Ä–∂–∫–µ structured output
- –ß–µ—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–¥–∞—á–∏
- Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

### 4. ‚úÖ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –±–µ–Ω—á–º–∞—Ä–∫–∏–Ω–≥–∞

–°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- `simple_benchmark.py` - –±—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç structured output
- `sgr_comparison_benchmark.py` - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ SGR
- `benchmarks/README.md` - –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã –∏–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### üü¢ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ:

1. **Claude 3.5 Haiku** - –ª—É—á—à–∏–π –≤—ã–±–æ—Ä (—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å + –∫–∞—á–µ—Å—Ç–≤–æ)
2. **SGR Full —Ä–µ–∂–∏–º** —É–ª—É—á—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∞ ~10% –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –≤ 1.7x
3. **Structured output –∫—Ä–∏—Ç–∏—á–µ–Ω** - –±–µ–∑ –Ω–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–æ –ø–∞–¥–∞–µ—Ç –Ω–∞ 70-80%

### üî¥ –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **SGR Lite –≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** - —Å–Ω–∏–∂–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –≤–º–µ—Å—Ç–æ —É–ª—É—á—à–µ–Ω–∏—è
2. **–ú–æ–¥–µ–ª–∏ –±–µ–∑ structured output** (Llama, —Å—Ç–∞—Ä—ã–µ Qwen) - –Ω–µ–ø—Ä–∏–≥–æ–¥–Ω—ã –¥–ª—è SGR
3. **GPT-4o-mini** - –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å–ª–æ–∂–Ω—ã–º–∏ —Å—Ö–µ–º–∞–º–∏

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–ª—è production:

```python
# –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
PRODUCTION_CONFIG = {
    "preferred_models": [
        "anthropic/claude-3.5-haiku",  # –õ—É—á—à–∏–π –±–∞–ª–∞–Ω—Å
        "openai/gpt-4o",               # –î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á
        "google/gemini-flash-1.5"      # –ë—é–¥–∂–µ—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
    ],
    "sgr_mode": "full",  # –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á
    "fallback": "baseline",  # –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö
    "cache": True,
    "retry_count": 2
}
```

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏/—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```python
# –ë—é–¥–∂–µ—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
DEV_CONFIG = {
    "preferred_models": [
        "google/gemini-2.0-flash-exp:free",  # –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
        "openai/gpt-4o-mini"                  # –î–µ—à–µ–≤–æ
    ],
    "sgr_mode": "baseline",  # –ü–æ–∫–∞ Lite –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
    "cache": True
}
```

## –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–∫—Ä–∏—Ç–∏—á–Ω–æ):
- [ ] –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å SGR Lite —Ä–µ–∂–∏–º
- [ ] –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å apply_sgr_v2 –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–≤–∞–∂–Ω–æ):
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–ø—Ä–æ—â–µ–Ω–∏–µ —Å—Ö–µ–º "–Ω–∞ –ª–µ—Ç—É"
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (—É–ª—É—á—à–µ–Ω–∏—è):
- [ ] –°–æ–∑–¥–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ö–µ–º—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ò—Ç–æ–≥

–ü—Ä–æ–µ–∫—Ç **—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–µ–Ω –¥–ª—è production** –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –º–æ–¥–µ–ª–µ–π —Å structured output
2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏—è SGR Full –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á
3. –û—Ç–∫–∞–∑–∞ –æ—Ç SGR Lite –¥–æ –µ–≥–æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏

–ö–ª—é—á–µ–≤–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ - **—á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π** –ø–æ –ø–æ–¥–¥–µ—Ä–∂–∫–µ structured output –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã.