# Отчет по результатам бенчмаркинга MCP-SGR

## Резюме

Проведено комплексное тестирование влияния SGR (Schema-Guided Reasoning) на качество и производительность различных LLM моделей через OpenRouter API.

### Ключевые находки:

1. **SGR Full режим улучшает качество на 9.3%** по сравнению с baseline
2. **SGR Lite показал снижение качества на 37%** - требует доработки
3. **Structured Output поддержка критична** для качественных результатов
4. **Латентность увеличивается в 1.7x** для SGR Full режима

## Детальные результаты

### 1. Сравнение режимов работы

| Режим | Качество (0-1) | Латентность (мс) | Успешность |
|-------|----------------|------------------|------------|
| Baseline | 0.670 | 9,480 | 75% |
| SGR Lite | 0.422 | 8,329 | 62.5% |
| SGR Full | 0.732 | 16,042 | 62.5% |

### 2. Результаты по моделям

#### Лучшие результаты с SGR:
- **Claude 3.5 Haiku**: Стабильно высокое качество (0.95) во всех режимах
- **GPT-4o-mini**: Отличное качество в baseline (0.95), но проблемы со structured output
- **Gemini Flash (free)**: Работает только с SGR, не работает в baseline

#### Проблемные модели:
- **Llama 3.1 8B**: Низкое качество без structured output (0.2 baseline → 0.6 SGR Full)

### 3. Анализ по типам задач

| Сценарий | Baseline | SGR Lite | SGR Full |
|----------|----------|----------|----------|
| Code Analysis | 0.57 | 0.24 | 0.70 |
| Planning | 0.64 | 0.58 | 0.76 |

Planning задачи лучше подходят для SGR подхода.

## Технические наблюдения

### Structured Output Support

Модели с поддержкой structured output показывают значительно лучшие результаты:
- **С поддержкой**: средний score 0.95
- **Без поддержки**: средний score 0.20

### Проблемы с API

1. **Rate limiting**: Gemini free tier часто возвращает 429 ошибки
2. **Structured output errors**: GPT-4o-mini иногда отвергает схемы (400 ошибки)
3. **Нестабильность**: Некоторые модели работают непредсказуемо с разными режимами

### Оптимальные конфигурации

1. **Для качества**: Claude 3.5 Haiku + SGR Full
2. **Для скорости**: Claude 3.5 Haiku + Baseline  
3. **Для бюджета**: Gemini Flash Free + SGR Lite (когда работает)

## Рекомендации по использованию SGR

### Когда использовать SGR Full:
- Сложные аналитические задачи
- Критично качество результата
- Модель поддерживает structured output
- Есть время на ожидание (2x латентность)

### Когда использовать Baseline:
- Простые задачи
- Критична скорость
- Модель хорошо работает со схемами (Claude, GPT-4)

### Когда НЕ использовать SGR Lite:
- Текущая реализация показывает снижение качества
- Требует доработки промптов и логики

## Стоимость

Примерная стоимость на 100 запросов:

| Модель | Baseline | SGR Full |
|--------|----------|----------|
| Gemini Free | $0.00 | $0.00 |
| GPT-4o-mini | $0.03 | $0.08 |
| Claude 3.5 Haiku | $0.10 | $0.25 |

## Выводы

1. **SGR работает**, но эффективность сильно зависит от модели и задачи
2. **Structured output критичен** для успеха SGR подхода
3. **SGR Full оправдан** для сложных задач с высокими требованиями к качеству
4. **SGR Lite требует доработки** - текущая реализация неэффективна
5. **Claude 3.5 Haiku** - лучший выбор для production использования SGR

## Дальнейшие шаги

1. Оптимизировать SGR Lite промпты
2. Добавить кеширование для снижения латентности SGR Full
3. Реализовать адаптивный выбор режима в зависимости от задачи
4. Протестировать больше моделей (GPT-4, Claude Sonnet)
5. Добавить метрики по токенам и точной стоимости